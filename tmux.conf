###################
#   _                           #
#  | |                          #
#  | |_ _ __ ___  _   ___  __   #
#  | __| '_ ` _ \| | | \ \/ /   #
#  | |_| | | | | | |_| |>  <    # 
#   \__|_| |_| |_|\__,_/_/\_\   #
#                               #
#################################

#################################
#         Basic Options         #
#################################



unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

#set -g prefix ^a
set -g status-keys vi

set -g mode-keys vi
set -g mouse on


#################################
#         Key bindings          #
#################################

# Reload configuration
bind r source-file ~/.tmux.conf

# Panel splits are replaced by ssh-split plugin. 
# See below
unbind %
#bind c split-window -h -c "#{pane_current_path}"
unbind '"'
#bind v split-window -v -c "#{pane_current_path}"


set-option -g @ssh-split-keep-cwd "true"
set-option -g @ssh-split-keep-remote-cwd "true"
#set-option -g @ssh-split-fail "false"
#set-option -g @ssh-split-no-env "false"
#set-option -g @ssh-split-no-shell "false"
#set-option -g @ssh-split-strip-cmd "true"

# Options seems to be mixed
set-option -g @ssh-split-h-key "v"
set-option -g @ssh-split-v-key "s"
set -g @plugin 'pschmitt/tmux-ssh-split'


# & -> kill-window
bind * new-window
bind n next-window
bind b previous-window

# Auto renumber windows on close
set-option -g renumber-windows on

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# only show status bar if there is more then one window
set -g status off
set-hook -g after-new-window      'if "[ #{session_windows} -gt 1 ]" "set status on"'
set-hook -g after-kill-pane       'if "[ #{session_windows} -lt 2 ]" "set status off"'
set-hook -g pane-exited           'if "[ #{session_windows} -lt 2 ]" "set status off"'
set-hook -g window-layout-changed 'if "[ #{session_windows} -lt 2 ]" "set status off"'

# Auto window rename
# This plugin requires zsh hook fix
# and modification
# set -g @plugin 'ofirgall/tmux-window-name'

# Configure windows status to pwd
# https://that.guru/blog/automatically-set-tmux-window-name/
set-option -g status-interval 5
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'
set -g allow-rename on


# Create window if it dosen't exist or switch to it
# https://unix.stackexchange.com/questions/285613/tmux-to-create-a-window-if-it-doesnt-exist-yet
bind-key 0 if-shell 'tmux select-window -t :0' '' 'new-window -t :0'
bind-key 1 if-shell 'tmux select-window -t :1' '' 'new-window -t :1'
bind-key 2 if-shell 'tmux select-window -t :2' '' 'new-window -t :2'
bind-key 3 if-shell 'tmux select-window -t :3' '' 'new-window -t :3'
bind-key 4 if-shell 'tmux select-window -t :4' '' 'new-window -t :4'
bind-key 5 if-shell 'tmux select-window -t :5' '' 'new-window -t :5'
bind-key 6 if-shell 'tmux select-window -t :6' '' 'new-window -t :6'
bind-key 7 if-shell 'tmux select-window -t :7' '' 'new-window -t :7'
bind-key 8 if-shell 'tmux select-window -t :8' '' 'new-window -t :8'
bind-key 9 if-shell 'tmux select-window -t :9' '' 'new-window -t :9'


# Move around panes with hjkl, as one would in vim
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize
bind H resize-pane -L 5
bind J resize-pane -D 5
bind K resize-pane -U 5
bind L resize-pane -R 5

# Kill
unbind x
bind x kill-pane
bind q kill-window
bind Q kill-session

set-option -g detach-on-destroy off

#################################
# COLORSCHEME: gruvbox dark     #
#################################
set-option -g status "on"
# default statusbar color
set-option -g status-style bg=default,fg=colour223 # bg=bg1, fg=fg1
# default window title colors
set-window-option -g window-status-style bg=colour214,fg=colour237 # bg=yellow, fg=bg1
# default window with an activity alert
set-window-option -g window-status-activity-style bg=colour237,fg=colour248 # bg=bg1, fg=fg3
# active window title colors
set-window-option -g window-status-current-style bg=red,fg=colour237 # fg=bg1
# pane border
set-option -g pane-active-border-style fg=colour250 #fg2
set-option -g pane-border-style fg=colour237 #bg1
# message infos
set-option -g message-style bg=colour239,fg=colour223 # bg=bg2, fg=fg1
# writing commands inactive
set-option -g message-command-style bg=colour239,fg=colour223 # bg=fg3, fg=bg1
# pane number display
set-option -g display-panes-active-colour colour250 #fg2
set-option -g display-panes-colour colour237 #bg1
# clock
set-window-option -g clock-mode-colour colour109 #blue
# bell
set-window-option -g window-status-bell-style bg=colour167,fg=colour235 # bg=red, fg=bg
## Theme settings mixed with colors (unfortunately, but there is no cleaner way)
set-option -g status-justify "left"
set-option -g status-left-style none
set-option -g status-left-length "80"
set-option -g status-right-style none
set-option -g status-right-length "80"
set-window-option -g window-status-separator ""
set-option -g status-left "#[bg=colour241,fg=colour248] #S #[bg=colour237,fg=colour241,nobold,noitalics,nounderscore]"
set-option -g status-right "#[bg=colour237,fg=colour239 nobold, nounderscore, noitalics]#[bg=colour239,fg=colour246] %Y-%m-%d  %H:%M #[bg=colour239,fg=colour248,nobold,noitalics,nounderscore]#[bg=colour248,fg=colour237] #h "
set-window-option -g window-status-current-format "#[bg=colour214,fg=colour237,nobold,noitalics,nounderscore]#[bg=colour214,fg=colour239] #I #[bg=colour214,fg=colour239,bold] #W#{?window_zoomed_flag,*Z,} #[bg=colour237,fg=colour214,nobold,noitalics,nounderscore]"
set-window-option -g window-status-format "#[bg=colour239,fg=colour237,noitalics]#[bg=colour239,fg=colour223] #I #[bg=colour239,fg=colour223] #W #[bg=colour237,fg=colour239,noitalics]"


# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Selection / clipboard plugins
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @yank_selection_mouse 'clipboard'
set -g @yank_selection 'clipboard' 
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @fzf-url-bind 'u'

# Pomodoro
# Work with customized sound alarm
set -g @plugin 'lcensies/tmux-pomodoro-plus'
set -g status-right "#{pomodoro_status}"
set -g @pomodoro_intervals 3
set -g @pomodoro_notifications 'on'
set -g @pomodoro_long_break_mins 15
set -g @pomodoro_repeat 'on' 
set -g @pomodoro_sound 'on' 


# Persistence across reboots
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
 # for vim
set -g @resurrect-strategy-vim 'session'
# for neovim
set -g @resurrect-strategy-nvim 'session'

# vimium-like shortcuts for selection
set -g @plugin 'fcsonline/tmux-thumbs'
unbind :
set -g @thumbs-key t

#set -g @plugin 'joshmedeski/t-smart-tmux-session-manager'
#unbind s
#set -g @t-bind "s"


# Navigation between vim and tmux panes with Ctrl + HJKL
# TODO: add pane close with Ctrl+X
set -g @plugin 'christoomey/vim-tmux-navigator'

set -g @plugin 'omerxx/tmux-sessionx'
# Requires bat installed
unbind o
set -g @sessionx-bind 'o'

 run '~/.tmux/plugins/tpm/tpm'

